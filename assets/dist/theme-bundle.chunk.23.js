(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{445:function(t,e,a){"use strict";a.r(e);var o=a(5),r=a(354),n=a(0),i=a.n(n),s=a(356),c=a(355),d=a(350),l=a.n(d),u=a(25),h=(a(431),a(97)),p=a(341);var f=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.formatCategoryTreeForJSTree=function(t){var e=this,a={text:t.data,id:t.metadata.id,state:{selected:t.selected}};return t.state&&(a.state.opened="open"===t.state,a.children=!0),t.children&&(a.children=[],t.children.forEach(function(t){a.children.push(e.formatCategoryTreeForJSTree(t))})),a},e.prototype.showProducts=function(){var t=c.a.replaceParams(window.location.href,{section:"product"});this.$productListingContainer.removeClass("u-hiddenVisually"),this.$facetedSearchContainer.removeClass("u-hiddenVisually"),this.$contentResultsContainer.addClass("u-hiddenVisually"),i()("[data-content-results-toggle]").removeClass("navBar-action-color--active"),i()("[data-content-results-toggle]").addClass("navBar-action"),i()("[data-product-results-toggle]").removeClass("navBar-action"),i()("[data-product-results-toggle]").addClass("navBar-action-color--active"),c.a.goToUrl(t)},e.prototype.showContent=function(){var t=c.a.replaceParams(window.location.href,{section:"content"});this.$contentResultsContainer.removeClass("u-hiddenVisually"),this.$productListingContainer.addClass("u-hiddenVisually"),this.$facetedSearchContainer.addClass("u-hiddenVisually"),i()("[data-product-results-toggle]").removeClass("navBar-action-color--active"),i()("[data-product-results-toggle]").addClass("navBar-action"),i()("[data-content-results-toggle]").removeClass("navBar-action"),i()("[data-content-results-toggle]").addClass("navBar-action-color--active"),c.a.goToUrl(t)},e.prototype.onReady=function(){var t=this,e=i()("[data-advanced-search-form]"),a=e.find("[data-search-category-tree]"),r=l.a.parse(window.location.href,!0),n=[];this.$productListingContainer=i()("#product-listing-container"),this.$facetedSearchContainer=i()("#faceted-search-container"),this.$contentResultsContainer=i()("#search-results-content"),i()("#facetedSearch").length>0?this.initFacetedSearch():(this.onSortBySubmit=this.onSortBySubmit.bind(this),o.c.on("sortBy-submitted",this.onSortBySubmit)),(this.context.enableSwatches||this.context.enableSizes)&&Object(p.a)(this.context),Object(u.b)(),i()("[data-product-results-toggle]").on("click",function(e){e.preventDefault(),t.showProducts()}),i()("[data-content-results-toggle]").on("click",function(e){e.preventDefault(),t.showContent()}),0===this.$productListingContainer.find("li.product").length||"content"===r.query.section?this.showContent():this.showProducts();var s=this.initValidation(e).bindValidation(e.find("#search_query_adv"));this.context.categoryTree.forEach(function(e){n.push(t.formatCategoryTreeForJSTree(e))}),this.categoryTreeData=n,this.createCategoryTree(a),e.on("submit",function(t){var o=a.jstree().get_selected();if(!s.check())return t.preventDefault();e.find('input[name="category[]"]').remove();var r=o,n=Array.isArray(r),c=0;for(r=n?r:r[Symbol.iterator]();;){var d;if(n){if(c>=r.length)break;d=r[c++]}else{if((c=r.next()).done)break;d=c.value}var l=d,u=i()("<input>",{type:"hidden",name:"category[]",value:l});e.append(u)}})},e.prototype.loadTreeNodes=function(t,e){var a=this;i.a.ajax({url:"/remote/v1/category-tree",data:{selectedCategoryId:t.id,prefix:"category"}}).done(function(t){var o=[];t.forEach(function(t){o.push(a.formatCategoryTreeForJSTree(t))}),e(o)})},e.prototype.createCategoryTree=function(t){var e=this,a={core:{data:function(t,a){"#"===t.id?a(e.categoryTreeData):e.loadTreeNodes(t,a)},themes:{icons:!0}},checkbox:{three_state:!1},plugins:["checkbox"]};t.jstree(a)},e.prototype.initFacetedSearch=function(){var t=this,e=i()("#product-listing-container"),a=i()("#faceted-search-container"),o=i()("#search-results-heading"),r=i()("#search-results-product-count"),n={template:{productListing:"search/product-listing",sidebar:"search/sidebar",heading:"search/heading",productCount:"search/product-count"},config:{product_results:{limit:this.context.searchProductsPerPage}},showMore:"search/show-more"};this.facetedSearch=new s.a(n,function(n){e.html(n.productListing),a.html(n.sidebar),o.html(n.heading),r.html(n.productCount),i()("html, body").animate({scrollTop:0},100),(t.context.enableSwatches||t.context.enableSizes)&&Object(p.a)(t.context)})},e.prototype.initValidation=function(t){return this.$form=t,this.validator=Object(h.a)({submit:t}),this},e.prototype.bindValidation=function(t){return this.validator&&this.validator.add({selector:t,validate:"presence",errorMessage:t.data("errorMessage")}),this},e.prototype.check=function(){return!!this.validator&&(this.validator.performCheck(),this.validator.areAll("valid"))},e}(r.a);e.default=f}}]);
